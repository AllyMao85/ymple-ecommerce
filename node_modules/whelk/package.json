{
  "_args": [
    [
      {
        "raw": "whelk@^6.0.0",
        "scope": null,
        "escapedName": "whelk",
        "name": "whelk",
        "rawSpec": "^6.0.0",
        "spec": ">=6.0.0 <7.0.0",
        "type": "range"
      },
      "/Users/fabienthetis/Documents/2017.10/Project_ymple/PRODUCT/ymple-commerce-1.0/node_modules/sails"
    ]
  ],
  "_from": "whelk@>=6.0.0 <7.0.0",
  "_id": "whelk@6.0.0",
  "_inCache": true,
  "_location": "/whelk",
  "_nodeVersion": "8.1.2",
  "_npmOperationalInternal": {
    "host": "s3://npm-registry-packages",
    "tmp": "tmp/whelk-6.0.0.tgz_1511250375090_0.9344826156739146"
  },
  "_npmUser": {
    "name": "mikermcneil",
    "email": "npm@sailsjs.com"
  },
  "_npmVersion": "5.2.0",
  "_phantomChildren": {
    "decamelize": "1.2.0",
    "graceful-readlink": "1.0.1",
    "window-size": "0.1.0"
  },
  "_requested": {
    "raw": "whelk@^6.0.0",
    "scope": null,
    "escapedName": "whelk",
    "name": "whelk",
    "rawSpec": "^6.0.0",
    "spec": ">=6.0.0 <7.0.0",
    "type": "range"
  },
  "_requiredBy": [
    "/sails"
  ],
  "_resolved": "https://registry.npmjs.org/whelk/-/whelk-6.0.0.tgz",
  "_shasum": "62e01d54dd5675cc022083de1756864d0c369418",
  "_shrinkwrap": null,
  "_spec": "whelk@^6.0.0",
  "_where": "/Users/fabienthetis/Documents/2017.10/Project_ymple/PRODUCT/ymple-commerce-1.0/node_modules/sails",
  "author": {
    "name": "Mike McNeil"
  },
  "bugs": {
    "url": "https://github.com/sailshq/whelk/issues"
  },
  "dependencies": {
    "@sailshq/lodash": "^3.10.2",
    "chalk": "1.1.3",
    "commander": "2.8.1",
    "flaverr": "^1.7.0",
    "machine": "^15.0.0-5",
    "rttc": "^10.0.0-0",
    "yargs": "3.4.5"
  },
  "description": "Run a JavaScript function as a shell script.",
  "devDependencies": {
    "eslint": "3.19.0",
    "machinepack-process": "^3.0.0-1",
    "mocha": "3.0.2"
  },
  "directories": {},
  "dist": {
    "integrity": "sha512-qNAuQ3af4oe9mzgYUmCKyxJKzfrx+JE2xN7QxrdNPBkpyFEw2rdABLofHxOl2OHgLEEAQTq2fqbpDQVQHvIg7g==",
    "shasum": "62e01d54dd5675cc022083de1756864d0c369418",
    "tarball": "https://registry.npmjs.org/whelk/-/whelk-6.0.0.tgz"
  },
  "gitHead": "bdf2a15885d9ba807dfdfe20edfa593cab8b28a3",
  "homepage": "https://github.com/sailshq/whelk#readme",
  "keywords": [
    "machine",
    "script",
    "sails",
    "cli"
  ],
  "license": "MIT",
  "main": "./lib/whelk.js",
  "maintainers": [
    {
      "name": "mikermcneil",
      "email": "npm@sailsjs.com"
    }
  ],
  "name": "whelk",
  "optionalDependencies": {},
  "readme": "# whelk\n\nRun a JavaScript function as a shell script.\n\n`whelk` is a built-in feature of the Sails framework that enables the use of `sails run`, but it can also be used as a standalone module.\n\nUseful for running jobs (from cron, Heroku scheduler), automating repetitive tasks (Grunt, gulp), writing one-off scripts (NPM, Chef), and building production-ready tools with command-line interfaces (e.g. `sails`, `machinepack`).  Supports _serial command-line arguments_, command-line opts (`--`), and environment variables.  Provides neater output for uncaught exceptions and promise rejections.\n\nThis package also includes optional support for command-line arg/opt validation, timeouts, and booting up and managing the lifecycle of a [Sails app](https://sailsjs.com) for access to your models, helpers, and custom configuration.\n\n\n```sh\n$ npm install whelk --save\n```\n\n> New to Node?  Check out [**Getting Started With whelk** from NPM](https://www.npmjs.com/package/whelk/tutorial).\n\n> Note: This package was formerly known as \"machine-as-script\", until it came time for a livelier name.\n\n\n## Usage\n\nIf you are using Sails > v1.x, you don't need to use `whelk` at all.  Just create a file in the `scripts/` folder of your app, like this one:\n\n```js\n// scripts/send-email-proof-reminders.js\nmodule.exports = {\n\n  description: 'Send a reminder to any recent users who haven\\'t confirmed their email address yet.',\n\n  inputs: {\n    template: {\n      description: 'The name of another email template to use as an optional override.',\n      type: 'string',\n      defaultsTo: 'reminder-to-confirm-email'\n    }\n  },\n\n  fn: async function (inputs, exits) {\n\n    await User.stream({\n      emailStatus: 'pending',\n      emailConfirmationReminderAlreadySent: false,\n      createdAt: { '>': Date.now() - 1000*60*60*24*3 }\n    })\n    .eachRecord(async(user, proceed)=>{\n      await sails.helpers.sendTemplateEmail({\n        to: user.emailAddress,\n        template: 'reminder-to-confirm-email',\n        templateData: {\n          user: user\n        }\n      });\n      return proceed();\n    });//∞\n\n    return exits.success();\n\n  }\n};\n```\n\nThen, for example, you can run:\n\n```sh\n$ sails run send-email-proof-reminders\n```\n\nOr, for convenience w/ tab-completion, even:\n\n```sh\n$ sails run scripts/send-email-proof-reminders.js\n```\n\nTo customize behavior:\n\n```sh\n$ sails run send-email-proof-reminders --template='alternative-reminder'\n```\n\nIn addition to command-line options, you can also use system environment variables or serial command-line arguments.  (More on that below.)\n\n\n\n## Standalone usage\n\n`whelk` can also be used outside of the context of a Sails app, for anything you like.\n\n```js\n#!/usr/bin/env node\n\nrequire('whelk')({\n  friendlyName: 'Proclaim sum',\n  inputs: {\n    a: { type: 'number', required: true },\n    b: { type: 'number', required: true },\n  },\n  fn: async function (inputs, exits) {\n    console.log(inputs.a + inputs.b);\n    return exits.success();\n  }\n});\n```\n\nNow you can run your machine as a script and provide input values as command-line opts:\n\n```sh\n$ node ./proclaim-sum.js --a=4 --b=5\n# Got result: 9\n```\n\n> Note that the machine definition you provide here doesn't have to come from an already-published machinepack-- it can be required locally from your project, or declared inline.\n\n\n\n##### Assorted examples\n\nIt's all well and good to build command-line scripts that do simple arithmetic, but what about something more practical?  Here are a few real-world examples of `whelk` in practice:\n\n+ https://github.com/node-machine/machinepack/blob/93a7132117546ed897fa8391997d0b8aa301d6e4/bin/machinepack-browserify.js\n+ https://github.com/node-machine/machinepack/blob/93a7132117546ed897fa8391997d0b8aa301d6e4/bin/machinepack-compare.js\n+ https://github.com/treelinehq/treeline/blob/32b8760504c46e9816ec89a1dc8e301e0c34f62a/bin/treeline-browse.js\n+ https://github.com/treelinehq/treeline/blob/763b293615e4b26339998a1384919cf958402ba8/bin/treeline-login.js\n\n\n\n## Available Options\n\nAside from the [normal properties that go into a Node Machine definition](http://node-machine.org/spec), the following additional options are supported:\n\n| Option            | Type            | Description                                            |\n|:------------------|-----------------|:-------------------------------------------------------|\n| `def`             | ((dictionary?)) | If specified, `whelk` will use this as the [shell script definition](http://node-machine.org).  Otherwise by default, it expects the definition to be passed in at the top-level.  In that case, the `whelk`-specific options like `envVarNamespace` are omitted when the shell script is built and executed.\n| `args`            | ((array?))      | The names of inputs, in order, to use for handling serial command-line arguments (more on that [below](#using-serial-command-line-arguments)).\n| `envVarNamespace` | ((string?))     | The namespace to use when mapping system environment variables to runtime argins for particular inputs (more on that [below](#using-system-environment-variables)).\n| `rawSerialCommandLineArgs` | ((array)) | An array of strings to use instead of attempting to automatically parse serial command-line arguments at runtime.  This is useful when bundling whelk within a higher-level module (like Sails, for example.)\n| `sails`           | ((SailsApp?))   | Only relevant if the machine def declares `habitat: 'sails'`.  This is the Sails app instance that will be provided to this machine as a habitat variable (`this.sails`).  In most cases, if you are using this, you'll want to set it to `require('sails').  The Sails app instance will be automatically loaded before running the machine, and automatically lowered as soon as the machine exits.\n| `useRawOutput`    | ((Boolean?))    | If enabled, raw output will be logged to stdout/stderr instead of formatted, human-readable output.  (Note that, with this enabled, if output is not already a string, it will be encoded as JSON, if possible.  The encoding semantics are similar to [`res.send()`](https://sailsjs.com/documentation/reference/response-res/res-send).)\n\n\n\n## Using serial command-line arguments\n\nIn addition to specifying inputs as `--` command-line opts, you can configure your script to accept _serial command-line arguments_, also known as \"positionals\".\n\nJust specify `args` in your script definition as an array of input names, in the expected order:\n\n```js\nrequire('whelk')({\n  friendlyName: 'Proclaim sum',\n  args: ['a', 'b'],\n  inputs: {\n    a: { type: 'number', required: true },\n    b: { type: 'number', required: true },\n  },\n  fn: async function (inputs, exits) {\n    console.log(inputs.a + inputs.b);\n    return exits.success();\n  }\n});\n```\n\nNow you can use serial command-line arguments to configure the related inputs:\n\n```sh\n$ node ./proclaim-sum.js 4 5\n# Got result: 9\n```\n\n\n#### Serial command-line arguments with dynamic arity\n\nSometimes, it's useful to be able to get _all_ serial command-line arguments, without having to declare your script's expectations beforehand.\n\nFor example, in the example above, we might want to support adding an infinite number of numbers delimited by spaces on the command line:\n\n```sh\n$ node ./proclaim-sum.js 4 5 10 -2382 31.482 13 48 139 13 1\n```\n\nTo help you accomplish this, `whelk` injects all serial command-line arguments via a special\nhabitat variable (`this.serialCommandLineArgs`).  Your machine can then loop over this array of strings\nand behave accordingly:\n\n```js\nrequire('whelk')({\n  friendlyName: 'Proclaim sum',\n  description: 'Log the sum of all of the provided numbers.',\n  exits: {\n    success: {\n      outputDescription: 'The sum of all the numbers that were specified via serial command-line args.',\n      outputExample: 9\n    },\n    invalidNumber: {\n      description: 'One of the provided command-line args could not be parsed as a number.'\n    }\n  },\n  fn: async function (inputs, exits) {\n    var sum = this.serialCommandLineArgs.reduce((memo, numberHopefully)=>{\n      var num = +numberHopefully;\n      if (Number.isNaN(num)) {\n        throw { invalidNumber: 'Could not parse `'+numberHopefully+'` as a number.' };\n      }\n      memo += num;\n      return memo;\n    });\n    return exits.success(sum);\n  }\n});\n```\n\nNote that `this.serialCommandLineArgs` is not affected by the `args` directive.  In other words, it is _always_ an array of strings, even if the `args` directive was provided and pointed at inputs w/ different types of examples (e.g. numbers, dictionaries, etc.).\n\n\n> ###### Compatibility\n>\n> + This habitat variable is the evolution of the `args` input from <=v3.\n> + Prior to v5, this was provided as `this.commandLineArgs` for a short period of time.\n\n\n\n\n## Using system environment variables\n\nSometimes (particularly in a production setting, like on Heroku) you want to be able to\nuse your machine as a script without specifying serial command-line arguments or checking in\ncredentials or other configuration details to source control.  This is typically accomplished\nusing environment variables.\n\nWhen using `whelk`, as an alternative to command-line opts, you can specify input values\nusing environment variables:\n\n```sh\n$ ___a=4 ___b=5 node ./proclaim-sum.js\n# Got result: 9\n```\n\nEnvironment variables work exactly like command-line opts, with the same escaping rules for specifying JSON arrays and dictionaries.\n\n\n##### Setting a namespace\n\nIt's usually a good idea to namespace the environment variables specific to your application.\nEspecially since many inputs have fairly common names (_as they should!_), it's helpful to use a prefix to avoid conflicts with env variables used by other processes.\n\nThe default namespace is 3 underscores (`___`).  In other words, if your machine has an input `foo`, then you could configure that input using the environment variable named `___foo`.\n\nTo customize the namespace for your script, just specify an `envVarNamespace`:\n\n```js\nrequire('whelk')({\n  envVarNamespace: 'add_numbers__',\n  def: {\n    friendlyName: 'Proclaim sum',\n    inputs: {\n      a: { type: 'number', required: true },\n      b: { type: 'number', required: true },\n    },\n    fn: async function (inputs, exits) {\n      console.log(inputs.a + inputs.b);\n      return exits.success();\n    }\n  }\n});\n```\n\nNow your custom string will be the expected namespace for environment variables:\n\n```sh\n$ add_numbers__a=4 add_numbers__b=5 node ./proclaim-sum.js\n```\n\n\n\n##### A note on case-sensitivity\n\nNote that input code names are _case-sensitive_, and therefore the names of environment variables understood by this module are also case-sensitive.\n\n[On Windows, the names of environment variables are capitalized/case-insensitive](https://en.wikipedia.org/wiki/Environment_variable#DOS), so you may have difficulties using this approach.  I'm happy to help in the implementation of a workaround if you need this and have any ideas for how to do it (hit me up [on Twitter](http://twitter.com/mikermcneil)).\n\n\n\n## Configuring non-string values\n\nSo it's really easy to see how string input values can be configured using command-line opts, arguments, or environment variables.  But more often than not, when configuring a script, you need to specify an input value that _isn't_ a string-- things like arrays, dictionaries, booleans, and numbers.\n\nThis module lets you configure _any_ input value-- even functions.  Internally, it uses the [`parseHuman()` method from `rttc`](https://github.com/node-machine/rttc#parsehumanstringfromhuman-typeschemaundefined-unsafemodefalse).  For a more detailed look at the exact rules, check out the README in the rttc repo.  Below, we look at one example for each of the major use cases you're likely to run into.\n\n##### Numeric inputs\n\n```sh\n$ node ./proclaim-sum.js --a='4' --b='5'\n```\n\n##### Boolean inputs\n\n```sh\n$ node ./divide-numbers.js --a='9' --b='5' --useFloatingPoint='false'\n```\n\n<!--\nNote: This should still work, but no reason to make everybody's brains bleed by putting\nthis in the README.  Contact mikermcneil on twitter if you need to use this and are having\nissues.\n\n##### Lamda (`->`) inputs\n\n```sh\n$ node ./each.js --array='[]' --iteratee='function (thing){ return thing.foo; }'\n```\n-->\n\n##### Dictionary (`{}`) and array (`[]`) inputs\n\nIf an input is expecting a dictionary or array (i.e. its example is a dictionary or array), then its value should be specified as JSON.\n\n```sh\n$ node ./count-keys.js --someDictionary='{\"this\": {\"must\": [\"be\",\"JSON\",\"encoded\"]}}'\n```\n\n```sh\n$ node ./count-items.js --someArray='[\"this\",\"must\",\"be\",\"JSON\",\"encoded\",\"too\"]'\n```\n\n##### JSON (`*`) inputs\n\nIf an input is expecting generic JSON (i.e. its example is `'*'`), then its value should be specified as JSON-- even if that value is a simple string, number, or boolean.\n\n```sh\n$ node ./is-null.js --value='{w: true, x: null, y: \"some string\", z: 34}'\n```\n\n```sh\n$ node ./is-null.js --value='[\"should be json encoded\", 4, null]'\n```\n\n```sh\n$ node ./is-null.js --value='\"even if it is a string\"'\n```\n\n```sh\n$ node ./is-null.js --value='22353'\n```\n\n```sh\n$ node ./is-null.js --value='true'\n```\n\n```sh\n$ node ./is-null.js --value='null'\n```\n\n\n##### Mutable reference (`===`) inputs\n\nFor the automatic console output of whelk, mutable reference inputs work just like JSON (`*`) inputs.\n\nTo learn more about data types, check out the Sails framework documentation or the [rttc README on GitHub](https://github.com/node-machine/rttc).\n\n\n\n\n## Misc\n\n\n##### Escaping your argins\n\nThe rules for escaping env vars, command-line opts, and serial command-line arguments can vary across operating systems.  However, a good reference point is the [escape machine in machinepack-process](http://node-machine.org/machinepack-process/escape).  That's what the `machinepack` command-line tool uses internally for creating code samples after a machine is run using `mp exec`, for example.\n\n\n##### Precedence\n\nIt's always best to keep things simple.  In keeping with that spirit, you should never _intentionally_ use both environment variables AND command-line opts/positionals to configure your script. But weird things are unavoidable, and when debugging, it's helpful to know more about the tools you use in case something jumps out.\n\nStarting from the highest precedence, here is a list of how this module prioritizes your input values:\n\n1. Serial command-line arguments (`./my-script.js bar`)\n2. System environment variables (`foo=bar ./my-script.js`)\n3. Command-line opts (`./my-script.js --foo='bar'`)\n\n\nIn other words, if you specify the same argin as a serial command-line argument AND as a system environment variable or command-line opt, the serial argument will always \"win\".  And if you specify the same input as a system environment variable and command-line opt, the system environment variable will always win.\n\n\n##### How it works\n\n`whelk` works by building a modified version of a machine instance that proxies argins for its inputs from serial command-line arguments (`myscript bar`), command-line opts (`myscript --foo='bar'`), and/or system environment variables (`___foo='bar' myscript`).\n\n##### Conventions\n\nIf you are building a command-line tool, it is conventional to keep these files in your project's `bin/` directory.  In a Sails app, use the `scripts/` folder (and instead of requiring `whelk`, just export your script definition using `module.exports`!)\n\n\n## Support\n\nFor more help, [click here](https://sailsjs.com/support).\n\n\n## License\n\nMIT &copy; 2015-2017 Mike McNeil, Sails Co.\n",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git+ssh://git@github.com/sailshq/whelk.git"
  },
  "scripts": {
    "custom-tests": "node ./node_modules/mocha/bin/mocha test",
    "lint": "node ./node_modules/eslint/bin/eslint . --max-warnings=0 --ignore-pattern 'test/'",
    "test": "npm run custom-tests && npm run lint"
  },
  "version": "6.0.0"
}
